# Generated by Django 5.1.3 on 2025-12-07 10:13

import django.core.validators
import django.db.models.deletion
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('authentication', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Project',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('name', models.CharField(blank=True, default='', max_length=200)),
                ('project_type', models.CharField(blank=True, choices=[('villa', 'Villa'), ('commercial', 'Commercial'), ('maintenance', 'Maintenance'), ('governmental', 'Governmental'), ('fitout', 'Fit-out / Renovation')], max_length=40)),
                ('villa_category', models.CharField(blank=True, choices=[('residential', 'Residential Villa'), ('commercial', 'Commercial Villa')], max_length=40)),
                ('contract_type', models.CharField(blank=True, choices=[('new', 'New Contract'), ('continue', 'Continuation Contract')], max_length=40)),
                ('status', models.CharField(choices=[('not_started', 'Not Yet Started'), ('execution_started', 'Execution Started'), ('under_execution', 'Under Execution'), ('temporarily_suspended', 'Temporarily Suspended'), ('handover_stage', 'In Handover Stage'), ('pending_financial_closure', 'Pending Financial Closure'), ('completed', 'Completed'), ('draft', 'Draft'), ('in_progress', 'In Progress')], default='not_started', max_length=30)),
                ('internal_code', models.CharField(blank=True, db_index=True, help_text='Starts with M, digits allowed, last digit must be odd (1,3,5,7,9).', max_length=40, validators=[django.core.validators.RegexValidator(message="Internal code must start with 'M' and end with an odd digit (1,3,5,7,9).", regex='^M[0-9]*[13579]$')])),
                ('approval_status', models.CharField(choices=[('draft', 'Draft'), ('pending', 'Pending Approval'), ('approved', 'Approved'), ('rejected', 'Rejected'), ('delete_requested', 'Delete Requested'), ('delete_approved', 'Delete Approved')], default='draft', help_text='حالة الموافقة على المشروع', max_length=30)),
                ('delete_requested_at', models.DateTimeField(blank=True, null=True)),
                ('delete_reason', models.TextField(blank=True, help_text='سبب طلب الحذف')),
                ('delete_approved_at', models.DateTimeField(blank=True, null=True)),
                ('last_approved_at', models.DateTimeField(blank=True, null=True)),
                ('approval_notes', models.TextField(blank=True, help_text='ملاحظات الموافقة/الرفض')),
                ('current_stage', models.ForeignKey(blank=True, help_text='المرحلة الحالية للمشروع في Workflow', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='projects', to='authentication.workflowstage')),
                ('delete_approved_by', models.ForeignKey(blank=True, help_text='المستخدم الذي وافق على حذف المشروع', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='delete_approvals', to=settings.AUTH_USER_MODEL)),
                ('delete_requested_by', models.ForeignKey(blank=True, help_text='المستخدم الذي طلب حذف المشروع', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='delete_requests', to=settings.AUTH_USER_MODEL)),
                ('last_approved_by', models.ForeignKey(blank=True, help_text='المستخدم الذي وافق/رفض آخر مرة', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approvals', to=settings.AUTH_USER_MODEL)),
                ('tenant', models.ForeignKey(blank=True, help_text='الشركة التي ينتمي إليها المشروع', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='projects', to='authentication.tenant')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Payment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('payer', models.CharField(choices=[('bank', 'Bank'), ('owner', 'Owner')], default='owner', max_length=20)),
                ('payment_method', models.CharField(blank=True, choices=[('cash_deposit', 'Cash Deposit in Company Bank Account'), ('cash_office', 'Cash Payment in Office'), ('bank_transfer', 'Bank Transfer'), ('bank_cheque', 'Bank Cheque')], max_length=50)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=14)),
                ('date', models.DateField()),
                ('description', models.TextField(blank=True)),
                ('deposit_slip', models.FileField(blank=True, help_text='Deposit Slip / Bank Deposit Proof', null=True, upload_to='payments/deposit_slips/')),
                ('invoice_file', models.FileField(blank=True, help_text='Invoice Used for Payment (فاتورة الدفع)', null=True, upload_to='payments/invoices/')),
                ('receipt_voucher', models.FileField(blank=True, help_text='Receipt Voucher (سند قبض)', null=True, upload_to='payments/receipts/')),
                ('tenant', models.ForeignKey(blank=True, help_text='الشركة التي ينتمي إليها هذا السجل', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_set', to='authentication.tenant')),
                ('project', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='payments', to='projects.project')),
            ],
            options={
                'verbose_name': 'Payment',
                'verbose_name_plural': 'Payments',
                'db_table': 'projects_payment',
                'ordering': ['-date', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='InitialInvoice',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=14, validators=[django.core.validators.MinValueValidator(Decimal('0'))])),
                ('stage', models.CharField(blank=True, help_text='Stage/Request identifier', max_length=100)),
                ('description', models.TextField(blank=True)),
                ('invoice_date', models.DateField()),
                ('invoice_number', models.CharField(blank=True, max_length=100, null=True, unique=True)),
                ('items', models.JSONField(blank=True, default=list, help_text='Invoice items: [{description, quantity, unit_price, total}]')),
                ('tenant', models.ForeignKey(blank=True, help_text='الشركة التي ينتمي إليها هذا السجل', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_set', to='authentication.tenant')),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='initial_invoices', to='projects.project')),
            ],
            options={
                'verbose_name': 'Initial Invoice',
                'verbose_name_plural': 'Initial Invoices',
                'db_table': 'projects_initial_invoice',
                'ordering': ['-invoice_date', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='Contract',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('contract_classification', models.CharField(blank=True, max_length=120)),
                ('contract_type', models.CharField(blank=True, max_length=120)),
                ('tender_no', models.CharField(blank=True, max_length=120)),
                ('contract_date', models.DateField(blank=True, null=True)),
                ('contractor_name', models.CharField(blank=True, max_length=200)),
                ('contractor_name_en', models.CharField(blank=True, max_length=200)),
                ('contractor_trade_license', models.CharField(blank=True, max_length=120)),
                ('contractor_phone', models.CharField(blank=True, max_length=20)),
                ('contractor_email', models.EmailField(blank=True, max_length=254)),
                ('total_project_value', models.DecimalField(blank=True, decimal_places=2, max_digits=14, null=True)),
                ('total_bank_value', models.DecimalField(blank=True, decimal_places=2, max_digits=14, null=True)),
                ('total_owner_value', models.DecimalField(blank=True, decimal_places=2, max_digits=14, null=True)),
                ('project_duration_months', models.PositiveIntegerField(default=0)),
                ('start_order_date', models.DateField(blank=True, null=True)),
                ('project_end_date', models.DateField(blank=True, null=True)),
                ('owner_includes_consultant', models.BooleanField(default=False)),
                ('owner_fee_design_percent', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('owner_fee_supervision_percent', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('owner_fee_extra_mode', models.CharField(blank=True, max_length=40)),
                ('owner_fee_extra_value', models.DecimalField(blank=True, decimal_places=2, max_digits=7, null=True)),
                ('bank_includes_consultant', models.BooleanField(default=False)),
                ('bank_fee_design_percent', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('bank_fee_supervision_percent', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('bank_fee_extra_mode', models.CharField(blank=True, max_length=40)),
                ('bank_fee_extra_value', models.DecimalField(blank=True, decimal_places=2, max_digits=7, null=True)),
                ('license_snapshot', models.JSONField(default=dict, editable=False)),
                ('owners', models.JSONField(blank=True, default=list, help_text="بيانات الملاك في العقد (قابلة للتحرير): [{'owner_name_ar': '...', 'owner_name_en': '...', 'phone': '...', 'email': '...', ...}, ...]")),
                ('general_notes', models.TextField(blank=True, help_text='ملاحظات عامة')),
                ('attachments', models.JSONField(blank=True, default=list, help_text='مرفقات العقد الديناميكية')),
                ('extensions', models.JSONField(blank=True, default=list, help_text="قائمة التمديدات: [{'reason': 'string', 'days': int, 'months': int}, ...]")),
                ('contract_file', models.FileField(blank=True, null=True, upload_to='contracts/main/')),
                ('contract_appendix_file', models.FileField(blank=True, null=True, upload_to='contracts/appendix/')),
                ('contract_explanation_file', models.FileField(blank=True, null=True, upload_to='contracts/explanations/')),
                ('start_order_file', models.FileField(blank=True, null=True, upload_to='contracts/start_orders/')),
                ('tenant', models.ForeignKey(blank=True, help_text='الشركة التي ينتمي إليها هذا السجل', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_set', to='authentication.tenant')),
                ('project', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='contract', to='projects.project')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='BuildingLicense',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('license_type', models.CharField(blank=True, max_length=120)),
                ('project_no', models.CharField(blank=True, max_length=120)),
                ('project_name', models.CharField(blank=True, max_length=200)),
                ('license_project_no', models.CharField(blank=True, max_length=120)),
                ('license_project_name', models.CharField(blank=True, max_length=200)),
                ('license_no', models.CharField(blank=True, max_length=120)),
                ('issue_date', models.DateField(blank=True, null=True)),
                ('last_issue_date', models.DateField(blank=True, null=True)),
                ('expiry_date', models.DateField(blank=True, null=True)),
                ('technical_decision_ref', models.CharField(blank=True, max_length=120)),
                ('technical_decision_date', models.DateField(blank=True, null=True)),
                ('license_notes', models.TextField(blank=True)),
                ('building_license_file', models.FileField(blank=True, null=True, upload_to='licenses/')),
                ('city', models.CharField(blank=True, max_length=120)),
                ('zone', models.CharField(blank=True, max_length=120)),
                ('sector', models.CharField(blank=True, max_length=120)),
                ('plot_no', models.CharField(blank=True, max_length=120)),
                ('plot_address', models.CharField(blank=True, max_length=255)),
                ('plot_area_sqm', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('land_use', models.CharField(blank=True, max_length=120)),
                ('land_use_sub', models.CharField(blank=True, max_length=120)),
                ('land_plan_no', models.CharField(blank=True, max_length=120)),
                ('consultant_same', models.BooleanField(default=True)),
                ('design_consultant_name', models.CharField(blank=True, max_length=200)),
                ('design_consultant_name_en', models.CharField(blank=True, max_length=200)),
                ('design_consultant_license_no', models.CharField(blank=True, max_length=120)),
                ('supervision_consultant_name', models.CharField(blank=True, max_length=200)),
                ('supervision_consultant_name_en', models.CharField(blank=True, max_length=200)),
                ('supervision_consultant_license_no', models.CharField(blank=True, max_length=120)),
                ('contractor_name', models.CharField(blank=True, max_length=200)),
                ('contractor_name_en', models.CharField(blank=True, max_length=200)),
                ('contractor_license_no', models.CharField(blank=True, max_length=120)),
                ('contractor_phone', models.CharField(blank=True, max_length=20)),
                ('contractor_email', models.EmailField(blank=True, max_length=254)),
                ('owners', models.JSONField(blank=True, default=list)),
                ('siteplan_snapshot', models.JSONField(default=dict, editable=False)),
                ('tenant', models.ForeignKey(blank=True, help_text='الشركة التي ينتمي إليها هذا السجل', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_set', to='authentication.tenant')),
                ('project', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='license', to='projects.project')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Awarding',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('award_date', models.DateField(blank=True, null=True)),
                ('consultant_registration_number', models.CharField(blank=True, max_length=120)),
                ('project_number', models.CharField(blank=True, max_length=120)),
                ('contractor_registration_number', models.CharField(blank=True, max_length=120)),
                ('awarding_file', models.FileField(blank=True, null=True, upload_to='awarding/')),
                ('tenant', models.ForeignKey(blank=True, help_text='الشركة التي ينتمي إليها هذا السجل', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_set', to='authentication.tenant')),
                ('project', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='awarding', to='projects.project')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='ActualInvoice',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=14, validators=[django.core.validators.MinValueValidator(Decimal('0'))])),
                ('invoice_date', models.DateField()),
                ('invoice_number', models.CharField(blank=True, max_length=100, null=True, unique=True)),
                ('description', models.TextField(blank=True)),
                ('items', models.JSONField(blank=True, default=list, help_text='Invoice items: [{description, quantity, unit_price, total}]')),
                ('tenant', models.ForeignKey(blank=True, help_text='الشركة التي ينتمي إليها هذا السجل', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_set', to='authentication.tenant')),
                ('initial_invoice', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='actual_invoices', to='projects.initialinvoice')),
                ('payment', models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='actual_invoice', to='projects.payment')),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='actual_invoices', to='projects.project')),
            ],
            options={
                'verbose_name': 'Actual Invoice',
                'verbose_name_plural': 'Actual Invoices',
                'db_table': 'projects_actual_invoice',
                'ordering': ['-invoice_date', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='SitePlan',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('municipality', models.CharField(blank=True, max_length=120)),
                ('zone', models.CharField(blank=True, max_length=120)),
                ('sector', models.CharField(blank=True, max_length=120)),
                ('road_name', models.CharField(blank=True, max_length=120)),
                ('plot_area_sqm', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('plot_area_sqft', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('land_no', models.CharField(blank=True, max_length=120)),
                ('plot_address', models.CharField(blank=True, max_length=255)),
                ('construction_status', models.CharField(blank=True, max_length=120)),
                ('allocation_type', models.CharField(blank=True, max_length=120)),
                ('land_use', models.CharField(blank=True, max_length=120)),
                ('base_district', models.CharField(blank=True, max_length=120)),
                ('overlay_district', models.CharField(blank=True, max_length=120)),
                ('allocation_date', models.DateField(blank=True, null=True)),
                ('developer_name', models.CharField(blank=True, max_length=200)),
                ('project_no', models.CharField(blank=True, max_length=120)),
                ('project_name', models.CharField(blank=True, max_length=200)),
                ('source_of_project', models.TextField(blank=True, help_text='مصدر المشروع')),
                ('notes', models.TextField(blank=True)),
                ('application_number', models.CharField(blank=True, max_length=120)),
                ('application_date', models.DateField(blank=True, null=True)),
                ('application_file', models.FileField(blank=True, null=True, upload_to='siteplans/applications/')),
                ('project', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='siteplan', to='projects.project')),
                ('tenant', models.ForeignKey(blank=True, help_text='الشركة التي ينتمي إليها هذا السجل', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_set', to='authentication.tenant')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='SitePlanOwner',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('owner_name_ar', models.CharField(blank=True, max_length=200)),
                ('owner_name_en', models.CharField(blank=True, max_length=200)),
                ('nationality', models.CharField(blank=True, max_length=120)),
                ('phone', models.CharField(blank=True, max_length=30)),
                ('email', models.EmailField(blank=True, max_length=254)),
                ('id_number', models.CharField(blank=True, max_length=50)),
                ('id_issue_date', models.DateField(blank=True, null=True)),
                ('id_expiry_date', models.DateField(blank=True, null=True)),
                ('id_attachment', models.FileField(blank=True, null=True, upload_to='owners/ids/')),
                ('right_hold_type', models.CharField(blank=True, default='Ownership', max_length=120)),
                ('share_possession', models.CharField(blank=True, max_length=120)),
                ('share_percent', models.DecimalField(decimal_places=2, default=100, max_digits=5, validators=[django.core.validators.MinValueValidator(Decimal('0')), django.core.validators.MaxValueValidator(Decimal('100'))])),
                ('siteplan', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='owners', to='projects.siteplan')),
                ('tenant', models.ForeignKey(blank=True, help_text='الشركة التي ينتمي إليها هذا السجل', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_set', to='authentication.tenant')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='Variation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=14, validators=[django.core.validators.MinValueValidator(Decimal('0'))])),
                ('description', models.TextField(blank=True)),
                ('approval_date', models.DateField(blank=True, null=True)),
                ('approved_by', models.CharField(blank=True, max_length=200)),
                ('attachments', models.JSONField(blank=True, default=list, help_text='List of attachment file paths/URLs')),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='variations', to='projects.project')),
                ('tenant', models.ForeignKey(blank=True, help_text='الشركة التي ينتمي إليها هذا السجل', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_set', to='authentication.tenant')),
            ],
            options={
                'verbose_name': 'Variation',
                'verbose_name_plural': 'Variations',
                'db_table': 'projects_variation',
                'ordering': ['-approval_date', '-created_at'],
            },
        ),
    ]
